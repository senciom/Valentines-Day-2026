<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Be Mine... Or Else?</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PHONE FRAME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="phone" id="phone">

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       SCREEN 1 Â· INTRO  (Street Fighter: Valentine Edition)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="screen screen-active" id="intro-screen">

    <!-- Particle layer (hearts + embers via JS) -->
    <div id="float-container" style="position:absolute;inset:0;pointer-events:none;overflow:hidden;z-index:2;"></div>

    <!-- City silhouette at bottom -->
    <svg class="sf-city" viewBox="0 0 393 130" preserveAspectRatio="xMidYMax meet">
      <rect x="0"   y="75" width="28" height="55" fill="#14001e"/>
      <rect x="10"  y="52" width="22" height="78" fill="#0e0018"/>
      <rect x="27"  y="68" width="24" height="62" fill="#14001e"/>
      <rect x="46"  y="48" width="16" height="82" fill="#0e0018"/>
      <rect x="57"  y="70" width="26" height="60" fill="#14001e"/>
      <rect x="78"  y="55" width="18" height="75" fill="#0e0018"/>
      <rect x="90"  y="40" width="14" height="90" fill="#14001e"/>
      <rect x="100" y="72" width="24" height="58" fill="#0e0018"/>
      <rect x="118" y="56" width="20" height="74" fill="#14001e"/>
      <rect x="132" y="44" width="12" height="86" fill="#0e0018"/>
      <rect x="140" y="68" width="30" height="62" fill="#14001e"/>
      <rect x="165" y="50" width="16" height="80" fill="#0e0018"/>
      <rect x="176" y="62" width="22" height="68" fill="#14001e"/>
      <rect x="194" y="42" width="18" height="88" fill="#0e0018"/>
      <rect x="206" y="74" width="28" height="56" fill="#14001e"/>
      <rect x="228" y="52" width="14" height="78" fill="#0e0018"/>
      <rect x="237" y="46" width="20" height="84" fill="#14001e"/>
      <rect x="253" y="64" width="24" height="66" fill="#0e0018"/>
      <rect x="273" y="50" width="16" height="80" fill="#14001e"/>
      <rect x="284" y="68" width="26" height="62" fill="#0e0018"/>
      <rect x="306" y="48" width="14" height="82" fill="#14001e"/>
      <rect x="315" y="60" width="20" height="70" fill="#0e0018"/>
      <rect x="330" y="44" width="18" height="86" fill="#14001e"/>
      <rect x="344" y="72" width="24" height="58" fill="#0e0018"/>
      <rect x="362" y="40" width="16" height="90" fill="#14001e"/>
      <rect x="374" y="66" width="19" height="64" fill="#0e0018"/>
      <rect x="14"  y="58" width="3" height="3" fill="rgba(255,140,210,.55)"/>
      <rect x="50"  y="56" width="2" height="2" fill="rgba(255,160,220,.45)"/>
      <rect x="94"  y="48" width="2" height="2" fill="rgba(255,140,210,.55)"/>
      <rect x="136" y="52" width="2" height="2" fill="rgba(255,160,220,.45)"/>
      <rect x="170" y="58" width="2" height="2" fill="rgba(255,140,210,.55)"/>
      <rect x="198" y="50" width="3" height="2" fill="rgba(255,160,220,.45)"/>
      <rect x="240" y="54" width="2" height="2" fill="rgba(255,140,210,.55)"/>
      <rect x="277" y="58" width="2" height="2" fill="rgba(255,160,220,.45)"/>
      <rect x="318" y="48" width="2" height="2" fill="rgba(255,140,210,.55)"/>
      <rect x="365" y="48" width="2" height="2" fill="rgba(255,160,220,.45)"/>
      <rect x="0" y="118" width="393" height="6" fill="rgba(200,0,130,.3)"/>
      <rect x="0" y="124" width="393" height="6" fill="#0a0014"/>
    </svg>

    <!-- Love meter bar -->
    <div class="sf-love-meter" id="sf-love-meter">
      <span class="sf-player-tag">1P</span>
      <div class="sf-bar-wrap">
        <div class="sf-bar-fill" id="sf-bar-fill"></div>
      </div>
      <span class="sf-player-tag">&#9829;</span>
    </div>

    <!-- SF-style title -->
    <div class="sf-title-block">
      <span class="sf-eyebrow">&mdash; Valentine Edition 2026 &mdash;</span>
      <span class="sf-title-line1">BE MINE</span>
      <span class="sf-title-line2">...OR ELSE?</span>
      <span class="sf-subtitle">&#9829; LOVE FIGHTER &#9829;</span>
    </div>

    <!-- Character section with inline SVG pixel art -->
    <div class="character-section">
      <div class="char-burst"></div>
      <div class="character-frame-glow">
        <div class="character-frame">

          <img src="Images/moreno.png" class="char-silhouette" alt="Character"
               style="width:100%; height:100%; object-fit:cover; border-radius:4px; opacity:0.9;">
        </div>
      </div>
    </div>

    <!-- Stage name -->
    <div class="sf-stage-name">Stage 1 &middot; Lover's Alley</div>

    <!-- Press Start -->
    <button class="press-start-btn" onclick="goToLogin()">
      Push &#9829; Button
    </button>

  </div><!-- /intro-screen -->


  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       SCREEN 2 Â· LOGIN  (Retro RPG Valentine)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="screen screen-hidden" id="login-screen">

    <div id="login-particles" style="position:absolute;inset:0;pointer-events:none;overflow:hidden;z-index:1;"></div>

    <div class="status-bar" style="background:transparent;position:relative;z-index:10;">
      <span class="status-time px" id="login-time">9:41</span>
      <div class="status-icons" style="color:rgba(255,180,220,.7);">
        <div class="signal-bars">
          <span></span><span></span><span></span><span></span>
        </div>
        <span style="font-size:10px;font-weight:700;font-family:'Press Start 2P',monospace;">WiFi</span>
        <span>&#x1F50B;</span>
      </div>
    </div>

    <div class="login-scroll">
      <div class="login-title-block">
        <div class="px login-game-badge">Valentine's Quest</div>
        <span class="px login-pixel-title" id="login-pixel-title"></span>
        <span class="px login-pixel-sub">&mdash; Player Select &mdash;</span>
      </div>

      <div class="hp-row" id="hp-row">
        <span class="px hp-label">LOVE</span>
      </div>

      <div class="rpg-panel">
        <span class="rpg-corner tl">&#9829;</span>
        <span class="rpg-corner tr">&#9829;</span>
        <span class="rpg-corner bl">&#9829;</span>
        <span class="rpg-corner br">&#9829;</span>

        <span class="rpg-label px">Player Name</span>
        <div class="rpg-row">
          <span class="rpg-arrow px">&#9654;</span>
          <input class="rpg-input" id="user-name" type="text"
                 placeholder="ENTER NAME..."
                 autocomplete="off" maxlength="18"
                 onkeydown="if(event.key==='Enter') document.getElementById('user-pass').focus()" />
        </div>

        <div class="rpg-sep"></div>

        <span class="rpg-label px">Secret Code</span>
        <div class="rpg-row">
          <span class="rpg-arrow px">&#9654;</span>
          <input class="rpg-input" id="user-pass" type="password"
                 placeholder="ENTER CODE..."
                 maxlength="18"
                 onkeydown="if(event.key==='Enter') handleLoginClick()" />
        </div>
      </div>

      <div class="rpg-error px" id="login-error"></div>

      <button class="rpg-btn-primary px" id="login-btn" onclick="handleLoginClick()">
        &#9829; BEGIN QUEST &#9829;
      </button>


    </div>
  </div><!-- /login-screen -->


  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       SCREEN 3 Â· VISUAL NOVEL  (Be Mine... Or Else?)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="screen screen-hidden" id="vn-screen">

    <!-- VN background (changes mood via JS class) -->
    <div class="vn-bg" id="vn-bg"></div>

    <!-- Scanline overlay -->
    <div class="vn-scanlines"></div>

    <!-- Floating particles for VN -->
    <div id="vn-particles" style="position:absolute;inset:0;pointer-events:none;overflow:hidden;z-index:2;"></div>

    <!-- Location header -->
    <div class="vn-location px" id="vn-location">The Classroom &mdash; Feb 13, 4:00 PM</div>

    <!-- Val character portrait area -->
    <div class="vn-portrait-area" id="vn-portrait-area">
      <div class="vn-portrait-frame" id="vn-portrait-frame">
        <div class="vn-portrait-emoji" id="vn-portrait-emoji">&#128522;</div>
      </div>
      <div class="vn-portrait-name px">Dudu</div>
    </div>

    <!-- Dialogue textbox -->
    <div class="vn-textbox" id="vn-textbox">
      <div class="vn-nameplate px" id="vn-nameplate">Dudu</div>
      <div class="vn-text" id="vn-text"></div>
      <div class="vn-continue px" id="vn-continue">&#9660;</div>
    </div>

    <!-- Choice overlay -->
    <div class="vn-choices" id="vn-choices" style="display:none"></div>

    <!-- Ending overlay -->
    <div class="vn-ending" id="vn-ending" style="display:none">
      <div class="vn-ending-inner">
        <div class="vn-ending-icon" id="vn-ending-icon"></div>
        <div class="vn-ending-title px" id="vn-ending-title"></div>
        <div class="vn-ending-subtitle px" id="vn-ending-subtitle"></div>
        <div class="vn-ending-desc" id="vn-ending-desc"></div>
        <button class="rpg-btn-primary px vn-replay-btn" onclick="restartVN()">
          &#9829; PLAY AGAIN &#9829;
        </button>
      </div>
    </div>

  </div><!-- /vn-screen -->

</div><!-- /phone -->


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     JAVASCRIPT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
'use strict';

/* â”€â”€ Clock â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function updateClocks() {
  const now = new Date();
  const h   = now.getHours() % 12 || 12;
  const m   = String(now.getMinutes()).padStart(2, '0');
  const t   = `${h}:${m}`;
  ['login-time'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.textContent = t;
  });
}
updateClocks();
setInterval(updateClocks, 30000);

let playerName = 'You';

/* â”€â”€ Title Screen Particles â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const floatContainer = document.getElementById('float-container');

function buildStars() {
  for (let i = 0; i < 55; i++) {
    const s = document.createElement('div');
    s.className = 'star-dot';
    const size = .8 + Math.random() * 2.2;
    s.style.cssText = `left:${Math.random()*100}%;top:${Math.random()*78}%;width:${size}px;height:${size}px;animation-duration:${1.4+Math.random()*3}s;animation-delay:${Math.random()*4}s;`;
    floatContainer.appendChild(s);
  }
}
buildStars();

const petalSet = ['ğŸŒ¸','ğŸŒ¸','ğŸŒ¸','ğŸ’®','ğŸŒº','ğŸ’•','âœ¨'];

function spawnPetal() {
  const el = document.createElement('div');
  el.className = 'particle';
  el.textContent = petalSet[Math.floor(Math.random() * petalSet.length)];
  el.style.left = (3 + Math.random() * 94) + '%';
  el.style.bottom = '-30px';
  const dur = 5 + Math.random() * 5;
  el.style.animationDuration = dur + 's';
  el.style.animationDelay = (Math.random() * 1.2) + 's';
  el.style.fontSize = (11 + Math.random() * 13) + 'px';
  el.style.opacity = '0';
  floatContainer.appendChild(el);
  setTimeout(() => el.remove(), (dur + 2) * 1000);
}

let petalTimer = setInterval(spawnPetal, 650);
for (let i = 0; i < 6; i++) setTimeout(spawnPetal, i * 180);

/* â”€â”€ Screen Transitions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function switchScreen(fromId, toId, cb) {
  const from = document.getElementById(fromId);
  const to   = document.getElementById(toId);
  from.classList.remove('screen-active');
  from.classList.add('screen-exit');
  to.classList.remove('screen-hidden');
  to.offsetHeight;
  to.classList.add('screen-active');
  setTimeout(() => {
    from.style.display = 'none';
    if (cb) cb();
  }, 460);
}

/* â”€â”€ Typewriter effect â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function typeWriter(el, text, speed, onDone) {
  el.textContent = '';
  let i = 0;
  const tick = () => {
    if (i < text.length) {
      el.textContent += text[i++];
      setTimeout(tick, speed);
    } else if (onDone) { onDone(); }
  };
  tick();
}

/* â”€â”€ HP hearts fill animation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function animateHP(total = 5) {
  const row = document.getElementById('hp-row');
  if (!row) return;
  row.querySelectorAll('.hp-heart').forEach(h => h.remove());
  for (let i = 0; i < total; i++) {
    const h = document.createElement('span');
    h.className = 'hp-heart';
    h.textContent = 'â™¥';
    row.appendChild(h);
    setTimeout(() => h.classList.add('filled'), 250 + i * 160);
  }
}

/* â”€â”€ Glitch on element â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let _glitchTimer = null;
function startGlitch(id) {
  const el = document.getElementById(id);
  if (!el) return;
  _glitchTimer = setInterval(() => {
    if (Math.random() < 0.28) {
      el.classList.add('glitch-effect');
      setTimeout(() => el.classList.remove('glitch-effect'), 350);
    }
  }, 2800);
}
function stopGlitch() { clearInterval(_glitchTimer); _glitchTimer = null; }

/* â”€â”€ Login background â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let _loginParticleTimer = null;
function buildLoginBg() {
  const c = document.getElementById('login-particles');
  if (!c) return;
  for (let i = 0; i < 32; i++) {
    const s = document.createElement('div');
    s.className = 'star-dot';
    const sz = .5 + Math.random() * 1.8;
    s.style.cssText = `left:${Math.random()*100}%;top:${Math.random()*100}%;width:${sz}px;height:${sz}px;animation-duration:${1.5+Math.random()*3}s;animation-delay:${Math.random()*5}s;`;
    c.appendChild(s);
  }
  const syms = ['â™¥','âœ¦','Â·','â™¡','Â·','âœ§'];
  _loginParticleTimer = setInterval(() => {
    const el = document.createElement('div');
    el.className = 'particle';
    el.textContent = syms[Math.floor(Math.random() * syms.length)];
    el.style.cssText = `left:${5+Math.random()*90}%;bottom:-20px;font-size:${7+Math.random()*8}px;color:rgba(255,${100+Math.floor(Math.random()*80)},${150+Math.floor(Math.random()*70)},.${3+Math.floor(Math.random()*4)});`;
    const dur = 7 + Math.random() * 5;
    el.style.animationDuration = dur + 's';
    c.appendChild(el);
    setTimeout(() => el.remove(), (dur + 2) * 1000);
  }, 1400);
}

/* â”€â”€ Pixel burst â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function pixelBurst(el) {
  const phone = document.getElementById('phone');
  const pr    = phone.getBoundingClientRect();
  const er    = el.getBoundingClientRect();
  const cx    = er.left + er.width / 2 - pr.left;
  const cy    = er.top  + er.height/ 2 - pr.top;
  const items = ['ğŸ’•','â™¥','âœ¦','ğŸŒ¸','ğŸ’–','âœ§'];
  for (let i = 0; i < 14; i++) {
    const p = document.createElement('div');
    p.style.cssText = `position:absolute;left:${cx}px;top:${cy}px;font-size:${9+Math.random()*10}px;pointer-events:none;z-index:9999;transition:transform 1s cubic-bezier(.2,1,.3,1),opacity 1s ease;opacity:1;`;
    p.textContent = items[Math.floor(Math.random() * items.length)];
    phone.appendChild(p);
    requestAnimationFrame(() => requestAnimationFrame(() => {
      const angle = (i / 14) * Math.PI * 2;
      const dist  = 45 + Math.random() * 65;
      p.style.transform = `translate(${Math.cos(angle)*dist}px,${Math.sin(angle)*dist}px) scale(0)`;
      p.style.opacity = '0';
    }));
    setTimeout(() => p.remove(), 1100);
  }
}

/* â”€â”€ Init login screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function initLoginScreen() {
  buildLoginBg();
  setTimeout(animateHP, 350);
  const titleEl = document.getElementById('login-pixel-title');
  if (titleEl) {
    setTimeout(() => {
      typeWriter(titleEl, 'PLAYER LOGIN', 85, () => startGlitch('login-pixel-title'));
    }, 180);
  }
}

/* â”€â”€ Press-start blink then transition â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function goToLogin() {
  clearInterval(petalTimer);
  const btn = document.querySelector('.press-start-btn');
  if (btn) {
    btn.style.animation = 'none';
    btn.disabled = true;
    let n = 0;
    const blink = setInterval(() => {
      btn.style.opacity = n % 2 === 0 ? '0' : '1';
      if (++n > 10) {
        clearInterval(blink);
        switchScreen('intro-screen', 'login-screen', initLoginScreen);
      }
    }, 70);
  } else {
    switchScreen('intro-screen', 'login-screen', initLoginScreen);
  }
}

/* â”€â”€ Love bar fill on intro load â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function animateLoveBar() {
  const fill = document.getElementById('sf-bar-fill');
  if (fill) setTimeout(() => fill.classList.add('full'), 400);
}
animateLoveBar();

/* â”€â”€ Login validation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let _hintShown = false;
function handleLoginClick() {
  const name    = document.getElementById('user-name').value.trim();
  const pass    = document.getElementById('user-pass').value;
  const errorEl = document.getElementById('login-error');
  const btn     = document.getElementById('login-btn');

  if (!name) {
    errorEl.textContent = '! ENTER YOUR NAME FIRST !';
    errorEl.classList.remove('shake');
    void errorEl.offsetWidth;
    errorEl.classList.add('shake');
    document.getElementById('user-name').focus();
    return;
  }

  if (pass !== '0811') {
    document.getElementById('user-pass').value = '';
    errorEl.textContent = '! WRONG CODE !';
    errorEl.classList.remove('shake');
    void errorEl.offsetWidth;
    errorEl.classList.add('shake');
    if (!_hintShown) {
      _hintShown = true;
      setTimeout(() => {
        errorEl.textContent = 'HINT: ANNIVERSARY (in digits)';
        errorEl.classList.remove('shake');
        void errorEl.offsetWidth;
        errorEl.classList.add('shake');
      }, 1400);
    } else {
      setTimeout(() => { errorEl.textContent = 'HINT: ANNIVERSARY (in digits)'; }, 1400);
    }
    document.getElementById('user-pass').focus();
    return;
  }

  _hintShown = false;
  playerName = name;
  errorEl.textContent = '';
  btn.textContent = 'â™¥ LOADING... â™¥';
  btn.disabled = true;
  pixelBurst(btn);
  setTimeout(() => goToVN(), 700);
}

/* â”€â”€ Transition to VN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function goToVN() {
  stopGlitch();
  clearInterval(_loginParticleTimer);
  _loginParticleTimer = null;
  switchScreen('login-screen', 'vn-screen', () => {
    initVN();
    startVN();
  });
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VISUAL NOVEL ENGINE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

const wait = ms => new Promise(r => setTimeout(r, ms));

/* â”€â”€ Val expressions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const VAL_MOODS = {
  happy:    { emoji: 'ğŸ˜Š', bg: 'mood-warm' },
  bright:   { emoji: 'ğŸ˜„', bg: 'mood-warm' },
  blush:    { emoji: 'ğŸ˜³', bg: 'mood-warm' },
  plead:    { emoji: 'ğŸ¥º', bg: 'mood-warm' },
  annoyed:  { emoji: 'ğŸ˜’', bg: 'mood-tense' },
  serious:  { emoji: 'ğŸ˜ ', bg: 'mood-tense' },
  smug:     { emoji: 'ğŸ˜', bg: 'mood-spicy' },
  whisper:  { emoji: 'ğŸ˜˜', bg: 'mood-spicy' },
  blank:    { emoji: 'ğŸ˜', bg: 'mood-dark' },
  yandere:  { emoji: 'ğŸ™‚', bg: 'mood-yandere' },
};

function setMood(mood) {
  const data = VAL_MOODS[mood] || VAL_MOODS.happy;
  document.getElementById('vn-portrait-emoji').textContent = data.emoji;

  const bg = document.getElementById('vn-bg');
  bg.className = 'vn-bg ' + data.bg;

  // Portrait frame color shift
  const frame = document.getElementById('vn-portrait-frame');
  frame.className = 'vn-portrait-frame';
  if (mood === 'yandere') frame.classList.add('yandere-frame');
  if (mood === 'smug' || mood === 'whisper') frame.classList.add('spicy-frame');
}

/* â”€â”€ VN particles â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let _vnParticleTimer = null;
function initVN() {
  const c = document.getElementById('vn-particles');
  // Stars
  for (let i = 0; i < 20; i++) {
    const s = document.createElement('div');
    s.className = 'star-dot';
    const sz = .5 + Math.random() * 1.5;
    s.style.cssText = `left:${Math.random()*100}%;top:${Math.random()*60}%;width:${sz}px;height:${sz}px;animation-duration:${2+Math.random()*3}s;animation-delay:${Math.random()*4}s;`;
    c.appendChild(s);
  }
  // Drifting symbols
  _vnParticleTimer = setInterval(() => {
    const el = document.createElement('div');
    el.className = 'particle';
    el.textContent = ['â™¥','âœ§','â™¡','Â·'][Math.floor(Math.random()*4)];
    el.style.cssText = `left:${5+Math.random()*90}%;bottom:-20px;font-size:${6+Math.random()*7}px;color:rgba(255,${120+Math.floor(Math.random()*80)},${160+Math.floor(Math.random()*60)},.25);`;
    const dur = 8 + Math.random() * 5;
    el.style.animationDuration = dur + 's';
    c.appendChild(el);
    setTimeout(() => el.remove(), (dur + 2) * 1000);
  }, 1800);
}

/* â”€â”€ Typewriter for VN text â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let _vnTypeTimer = null;
let _vnTypeResolve = null;
let _vnTextComplete = false;
let _vnFullText = '';

function vnTypeText(text) {
  return new Promise(resolve => {
    _vnTypeResolve = resolve;
    _vnTextComplete = false;
    _vnFullText = text;

    const el = document.getElementById('vn-text');
    const cont = document.getElementById('vn-continue');
    el.textContent = '';
    cont.classList.remove('visible');

    let i = 0;
    _vnTypeTimer = setInterval(() => {
      if (i < text.length) {
        el.textContent += text[i++];
      } else {
        clearInterval(_vnTypeTimer);
        _vnTypeTimer = null;
        _vnTextComplete = true;
        cont.classList.add('visible');
      }
    }, 30);
  });
}

function vnSkipOrAdvance() {
  if (_vnTypeTimer) {
    // Still typing â€” skip to end
    clearInterval(_vnTypeTimer);
    _vnTypeTimer = null;
    document.getElementById('vn-text').textContent = _vnFullText;
    _vnTextComplete = true;
    document.getElementById('vn-continue').classList.add('visible');
  } else if (_vnTextComplete && _vnTypeResolve) {
    // Text complete â€” advance
    _vnTextComplete = false;
    document.getElementById('vn-continue').classList.remove('visible');
    const r = _vnTypeResolve;
    _vnTypeResolve = null;
    r();
  }
}

/* â”€â”€ Click handler on VN textbox â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.addEventListener('DOMContentLoaded', () => {
  const textbox = document.getElementById('vn-textbox');
  textbox.addEventListener('click', vnSkipOrAdvance);

  // Also allow clicking the portrait area
  const portrait = document.getElementById('vn-portrait-area');
  portrait.addEventListener('click', vnSkipOrAdvance);
});

/* â”€â”€ Show a dialogue line â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function vnLine(speaker, text, mood) {
  if (mood) setMood(mood);

  const nameplate = document.getElementById('vn-nameplate');
  nameplate.textContent = speaker === 'MC' ? playerName : speaker;

  // Style nameplate by speaker
  nameplate.className = 'vn-nameplate px';
  if (speaker === 'MC') nameplate.classList.add('nameplate-mc');
  else if (speaker === 'System') nameplate.classList.add('nameplate-system');

  // Show portrait only for Val
  const portraitArea = document.getElementById('vn-portrait-area');
  portraitArea.style.opacity = speaker === 'Dudu' ? '1' : '0.3';

  await vnTypeText(text);
}

/* â”€â”€ Show choices and return selected id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function vnChoice(options) {
  return new Promise(resolve => {
    const container = document.getElementById('vn-choices');
    container.innerHTML = '';
    container.style.display = 'flex';

    options.forEach(opt => {
      const btn = document.createElement('button');
      btn.className = 'vn-choice-btn px';
      btn.textContent = opt.text;
      btn.onclick = () => {
        container.style.display = 'none';
        resolve(opt.id);
      };
      container.appendChild(btn);
    });
  });
}

/* â”€â”€ Show ending screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showEnding(type, title, subtitle, desc) {
  const overlay = document.getElementById('vn-ending');
  overlay.style.display = 'flex';
  overlay.className = 'vn-ending ' + type;

  document.getElementById('vn-ending-icon').textContent =
    type === 'ending-good' ? 'ğŸ’–' :
    type === 'ending-secret' ? 'ğŸ”¥' : 'ğŸ˜ˆ';

  document.getElementById('vn-ending-title').textContent = title;
  document.getElementById('vn-ending-subtitle').textContent = subtitle;
  document.getElementById('vn-ending-desc').textContent = desc;

  // Celebration burst for good/secret endings
  if (type !== 'ending-yandere') {
    vnCelebrate();
  } else {
    vnGlitchBurst();
  }
}

/* â”€â”€ VN celebration effect â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function vnCelebrate() {
  const phone = document.getElementById('phone');
  const emojis = type => type === 'ending-secret'
    ? ['ğŸ”¥','ğŸ’‹','ğŸ˜','âœ¨','ğŸ’–','ğŸŒ¹']
    : ['ğŸ’•','ğŸ’–','ğŸ‰','ğŸŒ¹','ğŸ’','âœ¨','ğŸ’—','ğŸŠ'];
  const items = emojis('ending-good');

  for (let i = 0; i < 22; i++) {
    setTimeout(() => {
      const el = document.createElement('div');
      el.className = 'celebrate-emoji';
      el.style.left = (20 + Math.random() * 60) + '%';
      el.style.top  = (30 + Math.random() * 40) + '%';
      el.style.fontSize = (16 + Math.random() * 16) + 'px';
      el.textContent = items[Math.floor(Math.random() * items.length)];
      phone.appendChild(el);
      requestAnimationFrame(() => requestAnimationFrame(() => {
        const dx = (Math.random() - 0.5) * 240;
        const dy = -(50 + Math.random() * 200);
        el.style.transform = `translate(${dx}px,${dy}px) rotate(${(Math.random()-.5)*360}deg)`;
        el.style.opacity = '0';
      }));
      setTimeout(() => el.remove(), 2000);
    }, i * 70);
  }
}

/* â”€â”€ VN glitch burst for yandere â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function vnGlitchBurst() {
  const screen = document.getElementById('vn-screen');
  let count = 0;
  const glitch = setInterval(() => {
    screen.classList.add('vn-glitch');
    setTimeout(() => screen.classList.remove('vn-glitch'), 150);
    if (++count > 6) clearInterval(glitch);
  }, 300);
}

/* â”€â”€ Screen shake â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function vnShake() {
  const screen = document.getElementById('vn-screen');
  screen.classList.add('vn-shake');
  setTimeout(() => screen.classList.remove('vn-shake'), 500);
}

/* â”€â”€ Restart VN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function restartVN() {
  document.getElementById('vn-ending').style.display = 'none';
  document.getElementById('vn-choices').style.display = 'none';
  document.getElementById('vn-text').textContent = '';
  document.getElementById('vn-continue').classList.remove('visible');
  startVN();
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DIALOGUE SCRIPT â€” "Be Mine... Or Else?"
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

async function startVN() {
  // Reset
  setMood('happy');
  document.getElementById('vn-location').textContent = 'The Classroom â€” Feb 13, 4:00 PM';

  await wait(600);
  await vnLine('System', '[ February 13th, 4:00 PM â€” The Classroom ]');
  await wait(300);
  await vnLine('Dudu', 'Hey! So... tomorrow is the 14th.', 'happy');
  await vnLine('Dudu', 'I was thinking, maybe you and I could finally go out?', 'bright');
  await vnLine('Dudu', 'I know a great Italian place.', 'happy');

  // â”€â”€ CHOICE 1 â”€â”€
  const c1 = await vnChoice([
    { text: "A) I'd love to!", id: 'yes' },
    { text: "B) Sorry, I'm busy.", id: 'no' }
  ]);

  if (c1 === 'yes') return goodEnding("I'd love to! That sounds amazing.");

  // â”€â”€ REJECTION #1 â”€â”€
  await vnLine('MC', "Sorry, I'm busy.");
  await vnLine('Dudu', "Busy? Come on, you can reschedule.", 'bright');
  await vnLine('Dudu', "It's just one dinner! Please?", 'plead');

  // â”€â”€ CHOICE 2 â”€â”€
  const c2 = await vnChoice([
    { text: "A) Okay, fine.", id: 'yes' },
    { text: "B) I really can't.", id: 'no' }
  ]);

  if (c2 === 'yes') return goodEnding("Okay, fine. Let's do it.");

  // â”€â”€ REJECTION #2 â”€â”€
  await vnLine('MC', "I really can't.");
  await vnLine('Dudu', "But I already bought those chocolates you like.", 'annoyed');
  await vnLine('Dudu', "The expensive ones. You wouldn't want them to go to waste, right?", 'plead');

  // â”€â”€ CHOICE 3 â”€â”€
  const c3 = await vnChoice([
    { text: "A) Well, for chocolate...", id: 'yes' },
    { text: "B) No thanks.", id: 'no' }
  ]);

  if (c3 === 'yes') return goodEnding("Well... for chocolate, I guess I can make time.");

  // â”€â”€ REJECTION #3 â”€â”€
  await vnLine('MC', "No thanks.");
  await vnLine('Dudu', "You're playing hard to get.", 'annoyed');
  await vnLine('Dudu', "It's cute, but my patience isn't infinite.", 'serious');
  await vnLine('Dudu', "Just say yes.", 'serious');

  // â”€â”€ CHOICE 4 (CRITICAL) â”€â”€
  const c4 = await vnChoice([
    { text: "A) Okay, okay! Yes!", id: 'yes' },
    { text: "B) I said no.", id: 'no' }
  ]);

  if (c4 === 'yes') return secretEnding();

  // â”€â”€ THE DESCENT â”€â”€
  await vnLine('MC', "I said no.");
  vnShake();
  await wait(800);
  setMood('blank');
  await wait(2000); // 3 sec stare
  await vnLine('Dudu', "...", 'blank');
  await vnLine('Dudu', "You're testing me.", 'blank');
  await vnLine('Dudu', "I don't like being tested.", 'serious');

  // â”€â”€ CHOICE 5 (FINAL) â”€â”€
  const c5 = await vnChoice([
    { text: "A) Fine, let's go.", id: 'yes' },
    { text: "B) Leave me alone.", id: 'no' }
  ]);

  if (c5 === 'yes') return goodEnding("Fine... let's just go.");

  // â”€â”€ YANDERE ENDING â”€â”€
  return yandereEnding();
}


/* â”€â”€ GOOD ENDING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function goodEnding(mcLine) {
  await vnLine('MC', mcLine);
  await vnLine('Dudu', "Really? Awesome!", 'bright');
  await vnLine('Dudu', "I'll pick you up at 7:00 PM sharp.", 'blush');
  await vnLine('Dudu', "Wear that jacket I like!", 'happy');
  await wait(400);

  showEnding(
    'ending-good',
    'GOOD ENDING',
    'UNLOCKED',
    'A perfect Valentine\'s date secured.'
  );
}


/* â”€â”€ SECRET ENDING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function secretEnding() {
  await vnLine('MC', "Okay, okay! Yes! You win.");
  await vnLine('Dudu', "Finally.", 'smug');
  await vnLine('Dudu', "I knew you wanted it as much as I did.", 'smug');
  await wait(300);
  await vnLine('Dudu', "Check your phone right now...", 'whisper');
  await vnLine('Dudu', "I just sent you a preview of what I have planned for dessert... ;)", 'whisper');
  await wait(400);

  showEnding(
    'ending-secret',
    'SECRET ENDING',
    'UNLOCKED',
    'Spicy vibes established.'
  );
}


/* â”€â”€ YANDERE / FUNNY ENDING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function yandereEnding() {
  await vnLine('MC', "Leave me alone.");
  await wait(600);
  vnShake();
  setMood('yandere');
  await wait(800);
  await vnLine('Dudu', "No.", 'yandere');
  await vnLine('MC', "Excuse me?");
  await vnLine('Dudu', "I said no.", 'yandere');
  await vnLine('Dudu', "I already told your mom we're going out.", 'yandere');
  await vnLine('Dudu', "I have the car running outside.", 'yandere');
  await vnLine('Dudu', "I locked the other doors to the school.", 'yandere');
  await vnLine('Dudu', "You literally have to go on a date with me.", 'yandere');
  await wait(300);
  vnShake();
  await vnLine('Dudu', "Don't worry, pookie.", 'yandere');
  await vnLine('Dudu', "You're going to have so much fun.", 'yandere');
  await vnLine('Dudu', "Forever.", 'yandere');
  await wait(500);

  showEnding(
    'ending-yandere',
    'FUNNY ENDING',
    'YANDERE UNLOCKED',
    'Task failed successfully: You have a date, whether you want one or not.'
  );
}
</script>

</body>
</html>
